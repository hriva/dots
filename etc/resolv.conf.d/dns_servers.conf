[Resolve]
DNS=1.0.0.1#cloudflare-dns.com 1.1.1.1#cloudflare-dns.com 2606:4700:4700::1001#cloudflare-dns.com 2606:4700:4700::1111#cloudflare-dns.com
FallbackDNS=9.9.9.9 149.112.112.112 2620:fe::9
Domains=~.
DNSOverTLS=yes

# This prevents failures if DNSSEC is not properly supported, bugged in Fedora
# DNSSEC=allow-downgrade

# Enable caching for performance (except negative responses)
Cache=yes

# Cache responses from localhost (if using local forwarders)
CacheFromLocalhost=no

# Enable DNS stub listener for local resolution
DNSStubListener=yes

# Read /etc/hosts for local overrides
ReadEtcHosts=yes

# Don't forward single-label queries to public DNS
ResolveUnicastSingleLabel=no

# Keep stale records for 30 seconds for resilience during outages
StaleRetentionSec=30

# Enable LLMNR for local network resolution (fallback)
LLMNR=yes

# Enable mDNS for .local domain resolution
MulticastDNS=yes
